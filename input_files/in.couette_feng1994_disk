# 2022-03-25
# Feng1994 disk in Couette flow
# Re=0.625


# parameters

#fluid
variable nu equal 1
variable rho equal 1
variable mu equal ${nu}*${rho}

variable v0 equal 5
variable c equal 20*${v0}
variable dp equal 0.05*$c*$c*${rho}/7


variable dx equal 0.1
variable rc equal 3*${dx}
variable m equal ${rho}*${dx}^2
variable r equal 1
variable L equal 8
variable LL equal 20
variable W equal 3*${dx}  #边界需要至少一个rc的厚度
variable y_lo equal -${W}   
variable y_hi equal ${L}+${W}
variable z_lo equal -0.5*${dx}
variable z_hi equal  0.5*${dx}
#初试圆柱放置的位置
variable xc equal 2*${r} 
variable yc equal 0.25*${L}


# 时间步的选择，计算下看哪个更小
#variable dt equal ${dx}*${dx}/${nu}/4
variable dt equal ${dx}/(${c}+${v0})/8

variable skin equal 0.1*${rc}

#总的模拟时间步
variable timesteps equal 2000000
variable ndump equal 100

#上下平板的速度
variable v_upper equal ${v0}
variable v_lower equal -${v0}


dimension	2
boundary p p p
units lj

atom_style	meso
# create geometry
region region_box block 0 ${LL} ${y_lo} ${y_hi} ${z_lo} ${z_hi} units box
create_box 4 region_box
lattice sq ${dx} origin 0.5 0.5 0
create_atoms    1 box

region	     region_cylinder cylinder z ${xc} ${yc} ${r} EDGE EDGE side in units box 
set          region region_cylinder type 2

region       region_wall_top block 0 ${LL} ${L} ${y_hi} ${z_lo} ${z_hi} units box
set          region region_wall_top type 3
region       region_wall_bottom block 0 ${LL} ${y_lo} 0 ${z_lo} ${z_hi} units box
set          region region_wall_bottom type 4



group           flow type 1
group           cylinder type 2
group           upper_wall type 3
group           lower_wall type 4
group           boundary union cylinder lower_wall upper_wall
group           wall union lower_wall upper_wall

mass		* ${m}

set		group all meso/rho 1

pair_style	hybrid/overlay sph/rhosum 1 sph/morris1997 sph/morris1997/noslip/flat sph/morris1997/noslip/sphere
#                             |  rc  |  kernel的类型编号 |  
pair_coeff      * * sph/rhosum  ${rc}  5
#                                              ｜ 声速 ｜ 粘性 ｜ rc｜ 核函数｜
pair_coeff		1 1 sph/morris1997 ${c} ${mu} ${rc} 5
#                                              | 声速｜粘性 ｜ rc｜ 核函数 ｜圆柱group| 圆柱的半径|边界限制参数|
pair_coeff      1 2 sph/morris1997/noslip/sphere ${c} ${mu} ${rc} 5 cylinder ${r} 0.5
#                                              |平板的速度| 声速｜粘性 ｜ rc｜ 核函数 ｜平板group| 平板边界的位置 | 边界限制参数|
pair_coeff      1 3 sph/morris1997/noslip/flat ${v_upper} ${c} ${mu} ${rc} 5 upper_wall ${L} 100
pair_coeff      1 4 sph/morris1997/noslip/flat ${v_lower} ${c} ${mu} ${rc} 5 lower_wall 0 100

fix             integrate_1 flow meso
fix             integrate_2 cylinder rigid/meso single
fix             integrate_3 upper_wall meso/move linear ${v0} 0 0 units box
fix             integrate_4 lower_wall meso/move linear -${v0} 0 0 units box


compute rho_peratom all meso/rho/atom

fix 			8 cylinder ave/time 1 1 100 f_2[1] f_2[2] f_2[3] f_2[4] f_2[5] f_2[6] f_2[7] f_2[8] f_2[9] f_2[10] f_2[11] f_2[12] f_2[13] f_2[14] f_2[15] f_2[16] mode vector ave one file dump_disk.txt

fix 9 all enforce2d

timestep ${dt}
neighbor ${skin} bin
neigh_modify	delay 0 every 1 check yes
thermo		${ndump}
dump		1 all custom 1000 dump.lammpstrj id type x y z vx vy vz c_rho_peratom 
run ${timesteps}
